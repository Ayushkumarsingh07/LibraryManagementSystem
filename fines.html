<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fines - LibraFlow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-7xl mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2 border-gray-300">Fines</h1>

        <div class="mb-4">
            <input type="text" id="searchInput" placeholder="Search by member name..." class="w-full px-4 py-2 border rounded-lg shadow-sm focus:outline-none focus:ring focus:border-blue-300">
        </div>

        <div class="overflow-x-auto bg-white p-6 shadow-lg rounded-lg border border-gray-200">
            <table class="min-w-full text-sm text-left text-gray-700">
                <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                    <tr>
                        <th class="px-4 py-3">Fine ID</th>
                        <th class="px-4 py-3">Member</th>
                        <th class="px-4 py-3">Amount</th>
                        <th class="px-4 py-3">Reason</th>
                        <th class="px-4 py-3">Date</th>
                        <th class="px-4 py-3">Status</th>
                        <th class="px-4 py-3">Actions</th>
                    </tr>
                </thead>
                <tbody id="fineTableBody">
                    <!-- Fine rows inserted via JS -->
                </tbody>
            </table>
        </div>

        <a href="index.html" class="text-sm mt-6 inline-block text-blue-600 hover:underline">← Back to Dashboard</a>
    </div>
</body>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const fines = JSON.parse(localStorage.getItem('fines')) || [];
    const tbody = document.getElementById('fineTableBody');
    const searchInput = document.getElementById('searchInput');

    function renderFines(filter = '') {
      tbody.innerHTML = '';
      fines
        .filter(fine => fine.member.toLowerCase().includes(filter.toLowerCase()))
        .forEach((fine, index) => {
          const row = document.createElement('tr');
          const statusColor = fine.status === 'Paid' ? 'text-green-600' : fine.status === 'Unpaid' ? 'text-red-600' : 'text-gray-500';
          row.className = index % 2 === 0 ? 'bg-white' : 'bg-gray-50';
          row.innerHTML = `
            <td class="border px-4 py-2">${fine.id}</td>
            <td class="border px-4 py-2">${fine.member}</td>
            <td class="border px-4 py-2">₹${fine.amount}</td>
            <td class="border px-4 py-2">${fine.reason}</td>
            <td class="border px-4 py-2">${fine.date}</td>
            <td class="border px-4 py-2 font-semibold ${statusColor}">${fine.status}</td>
            <td class="border px-4 py-2">
              ${fine.status === 'Unpaid' ? `
                <button
                  class="bg-green-500 hover:bg-green-600 text-white text-xs px-4 py-1 rounded shadow-sm transition duration-150 ease-in-out pay-btn"
                  data-id="${fine.id}">
                  Pay ₹${fine.amount}
                </button>` : '<span class="text-green-600 text-xs font-medium">Paid</span>'
              }
            </td>
          `;
          tbody.appendChild(row);
        });
    }

    renderFines();

    tbody.addEventListener('click', (e) => {
      if (e.target.classList.contains('pay-btn')) {
        const id = e.target.getAttribute('data-id');
        const fineIndex = fines.findIndex(f => f.id == id);
        if (fineIndex !== -1) {
          if (confirm(`Are you sure you want to pay ₹${fines[fineIndex].amount}?`)) {
            fines[fineIndex].status = 'Paid';
            localStorage.setItem('fines', JSON.stringify(fines));
            renderFines(searchInput.value);
            alert(`Payment of ₹${fines[fineIndex].amount} successful.`);
          }
        }
      }
    });

    searchInput.addEventListener('input', () => {
      renderFines(searchInput.value);
    });
  });
</script>
</html>
